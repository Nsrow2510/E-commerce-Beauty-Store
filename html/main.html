<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Veloura - Makeup</title>
  <link rel="icon" type="image/png" href="../images/logo.png">
  <link rel="stylesheet" href="../css/home.css"/>
</head>
<body>
<!-- Navbar -->
<header class="navbar">
  <!-- Left: Logo -->
  <div class="nav-left">
    <div class="logo">
      <img src="../images/logo.png" alt="Veloura Logo" class="logo-img">
      <span>Veloura</span>
    </div>
  </div>

  <!-- Center: Dropdown Menus -->
  <nav class="nav-center">
    <div class="dropdown">
      <span class="dropdown-label">Skincare</span>
      <div class="mega-menu">
        <div class="mega-column">
          <h4>Face Care</h4>
          <ul>
            <li><a href="facemositurizer.html">Face Moisturizer</a></li>
            <li><a href="cleansers.html">Cleansers</a></li>
            <li><a href="serum.html">Serum</a></li>
            <li><a href="toner.html">Toners</a></li>
            <li><a href="sunscreen.html">Sunscreens</a></li>
            <li><a href="mask.html">Face Masks</a></li>
          </ul>
        </div>
        <div class="mega-column">
          <h4>Lip Care</h4>
          <ul>
            <li><a href="lipbalm.html">Lip Balm</a></li>
            <li><a href="lipscrubs.html">Lip Scrub</a></li>
            <li><a href="lipmasks.html">Lip Masks</a></li>
          </ul>
        </div>
        <div class="mega-column">
          <h4>Body Care</h4>
          <ul>
            <li><a href="#">Lotions & Creams</a></li>
            <li><a href="#">Body Scrubs</a></li>
            <li><a href="#">Body Sunscreens</a></li>
            <li><a href="#">Soaps & Body Wash</a></li>
          </ul>
        </div>
        <div class="mega-column">
          <h4>Eye Care</h4>
          <ul>
            <li><a href="#">Undereye Creams & Serums</a></li>
            <li><a href="#">Eye Masks</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="dropdown">
      <span class="dropdown-label">Makeup</span>
      <div class="mega-menu">
        <div class="mega-column">
          <h4>Face</h4>
          <ul>
            <li><a href="foundation.html">Foundation</a></li>
            <li><a href="concealer.html">Concealer</a></li>
            <li><a href="primer.html">Primer</a></li>
            <li><a href="highlighter.html">Highlighter</a></li>
          </ul>
        </div>
        <div class="mega-column">
          <h4>Eyes</h4>
          <ul>
            <li><a href="mascara.html">Mascara</a></li>
            <li><a href="eyeliner.html">Eyeliner</a></li>
            <li><a href="eyeshadow.html">Eyeshadow</a></li>
            <li><a href="kajal.html">Kajal</a></li>
          </ul>
        </div>
        <div class="mega-column">
          <h4>Lips</h4>
          <ul>
            <li><a href="lipstick.html">Lipstick</a></li>
            <li><a href="lipgloss.html">Lip Gloss</a></li>
            <li><a href="lipliner.html">Lip Liner</a></li>
            <li><a href="lip_tint.html">Lip Tints</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="dropdown">
      <span class="dropdown-label">Fragrances</span>
      <div class="mega-menu">
        <!-- <div class="mega-column">
          <h4>By Type</h4>
          <ul>
            <li><a href="#">Perfume</a></li>
            <li><a href="#">Body Mists</a></li>
            <li><a href="#">Roll-ons</a></li>
          </ul>
        </div> -->
        <div class="mega-column">
          <h4>By Gender</h4>
          <ul>
            <li><a href="fragrances_women.html">For Women</a></li>
            <li><a href="fragrances_men.html">For Men</a></li>
            <li><a href="fragrances_unisex.html">Unisex</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="dropdown">
      <span class="dropdown-label">Tools</span>
    </div>

    <!-- <div class="nav-links">
      <a href="tools.html" class="nav-link">Tools</a>
    </div> -->

  </nav>

  <!-- Right: Search + Icons -->
  <div class="nav-right">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search for products..." />
      <button id="searchButtn">Search</button>
    </div>

    <a href="login.html" class="icon-link" id="login-user-link">ðŸ‘¤</a>
    <a href="AddToCart.html" class="icon-link cart">
      ðŸ›’<span class="badge">0</span>
    </a>
  </div>
</header>

  <section class="hero">
    <div class="hero-content">
      <div class="hero-text">
        <h1>Discover Your<br><span>Natural Beauty</span></h1>
        <p>
          Elevate your beauty routine with our curated collection of premium cosmetics, skincare, and tools designed to make you feel confident and radiant.
        </p>
        <div class="hero-buttons">
          <a href="#" class="btn primary">Shop Now</a>
          <a href="#" class="btn secondary">Explore Collection</a>
        </div>
        <div class="features">
          <div><strong>100+</strong><br>Premium Products</div>
          <div><strong>24/7</strong><br>Beauty Support</div>
          <div><strong>Free</strong><br>Shipping</div>
        </div>
      </div>
      <div class="hero-img">
        <img src="../images/mainpageiamge.png" alt="Makeup Products" />
      </div>
    </div>
  </section>

  <section class="bestsellers-section">
  <h2>Bestsellers</h2>
  <p class="subtitle">Explore the most loved products by our customers</p>
  <div class="product-grid">

  <!-- Product 1 -->
  <div class="product-box">
    <div class="product-labels">
      <span class="label bestseller">BESTSELLER</span>
    </div>
    <a href="langeiedetail.html">
      <img src="../images/langeielipbalm.jpg" alt="LANEIGE Lip Glowy Balm" class="product-image">
    </a>
    <h3 class="product-name">LANEIGE Lip Glowy Balm Berry Fruits Rouges(10g)</h3>
    <div class="price-row">
      <span class="mrp">MRP: <del>â‚¹750</del></span>
      <span class="price">â‚¹638</span>
      <span class="discount">15% Off</span>
    </div>
    <button class="add-to-cart-btn" onclick="addToCart('prod-1', 'LANEIGE Lip Glowy Balm', 'â‚¹638', 'langeielipbalm.jpg')">Add to Cart</button>

    <div class="bottom-details">
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜… <span>(21817)</span></div>
      <p class="shade-count">6 Shades</p>
    </div>
  </div>

  <!-- Product 2 -->
  <div class="product-box">
    <div class="product-labels">
      <span class="label bestseller">BESTSELLER</span>
      <span class="label featured">FEATURED</span>
    </div>
    <a href="dotnkeyserumdetail.html">
      <img src="../images/dotnkeyserum.jpg" alt="dotnkey face Serum" class="product-image">
    </a>
    <h3 class="product-name">DOT & KEY 10% vitamin C + E face Serum</h3>
    <div class="price-row">
      <span class="mrp">MRP: <del>â‚¹499</del></span>
      <span class="price">â‚¹429</span>
      <span class="discount">14% Off</span>
    </div>
    <button class="add-to-cart-btn" onclick="addToCart('prod-2', 'DOT & KEY Vitamin C Serum', 'â‚¹429', 'dotnkeyserum.jpg')">Add to Cart</button>

    <div class="bottom-details">
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜† <span>(24291)</span></div>
      <p class="shade-count">2 Sizes</p>
    </div>
  </div>

  <!-- Product 3 -->
  <div class="product-box">
    <div class="product-labels">
      <span class="label bestseller">BESTSELLER</span>
    </div>
    <a href="MACfoundationdetail.html">
      <img src="../images/macfoundation.avif" alt="foundation" class="product-image">
    </a>
    <h3 class="product-name">M.A.C studio fix fluid spf 15 soft matte foundation</h3>
    <div class="price-row">
      <span class="mrp">MRP: <del>â‚¹4000</del></span>
      <span class="price">â‚¹3400</span>
      <span class="discount">15% Off</span>
    </div>
    <button class="add-to-cart-btn" onclick="addToCart('prod-3', 'M.A.C Foundation', 'â‚¹3400', 'macfoundation.avif')">Add to Cart</button>

    <div class="bottom-details">
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜† <span>(13550)</span></div>
      <p class="shade-count">5 shades</p>
    </div>
  </div>

  <!-- Product 4 -->
  <div class="product-box">
    <div class="product-labels">
      <span class="label bestseller">BESTSELLER</span>
      <span class="label featured">FEATURED</span>
    </div>
    <a href="brosonbrushesdetail.html">
      <img src="../images/bronsonbrushes.webp" alt="10-Piece Brush Set" class="product-image">
    </a>
    <h3 class="product-name">Bronson Professional premium 10-Piece Brush Set</h3>
    <div class="price-row">
      <span class="mrp">MRP: <del>â‚¹450</del></span>
      <span class="price">â‚¹360</span>
      <span class="discount">20% Off</span>
    </div>
    <button class="add-to-cart-btn" onclick="addToCart('prod-4', 'Bronson Brush Set', 'â‚¹360', 'bronsonbrushes.webp')">Add to Cart</button>

    <div class="bottom-details">
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜… <span>(12045)</span></div>
    </div>
  </div>

</div>
  </section>

  <section class="featured-products-section">
  <h2>Featured Products</h2>
  <p class="subtitle">Handpicked favorites to elevate your beauty routine</p>

  <div class="product-grid">

    <!-- Product 5 -->
    <div class="product-box">
      <div class="product-labels">
        <span class="label featured">FEATURED</span>
        <span class="label bestseller">BESTSELLER</span>
      </div>
      <a href="foundation_7.html">
        <img src="../images/foundation_1.avif" alt="Liquid Foundation" class="product-image">
      </a>
      <h3 class="product-name">L'Oreal Paris Infallible 24H Tinted Serum Foundation</h3>
      
      <div class="price-row">
        <span class="mrp"><del>â‚¹999</del></span>
        <span class="price">â‚¹749</span>
        <span class="discount">25% Off</span>
      </div>
      <button class="add-to-cart-btn" onclick="addToCart('prod-5', 'L\'Oreal Foundation', 'â‚¹749', 'foundation_1.avif')">Add to Cart</button>
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜… <span>(589)</span></div>
      <p class="shade-count">7 Shades</p>
    </div>

    <!-- Product 6 -->
    <div class="product-box">
      <div class="product-labels">
        <span class="label featured">FEATURED</span>
      </div>
      <a href="mascara_3.html">
        <img src="../images/L'Oreal Paris mascara.webp" alt="Volumizing Mascara" class="product-image">
      </a>
      <h3 class="product-name">L'Oreal Paris Voluminous Panorama Waterproof</h3>
  
      <div class="price-row">
        <span class="mrp"><del>â‚¹999</del></span>
        <span class="price">â‚¹899</span>
        <span class="discount">10% Off</span>
      </div>
      <button class="add-to-cart-btn" onclick="addToCart('prod-6', 'L\'Oreal Mascara', 'â‚¹899', 'L\'Oreal Paris mascara.webp')">Add to Cart</button>
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜† <span>(1895)</span></div>
    </div>

    <!-- Product 7 -->
    <div class="product-box">
      <div class="product-labels">
        <span class="label featured">FEATURED</span>
      </div>
      <a href="highlighter.html">
        <img src="../images/facecandahighlighter.avif" alt="Radiant Highlighter" class="product-image">
      </a>
      <h3 class="product-name">Face Canada Strobe Cream Primer + Highlighter</h3>
      
      <div class="price-row">
        <span class="mrp"><del>â‚¹599</del></span>
        <span class="price">â‚¹495</span>
        <span class="discount">17% Off</span>
      </div>
      <button class="add-to-cart-btn" onclick="addToCart('prod-7', 'Face Canada Highlighter', 'â‚¹495', 'facecandahighlighter.avif')">Add to Cart</button>
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜† <span>(1764)</span></div>
      <p class="shade-count">5 Shades</p>
    </div>

    <!-- Product 8 -->
    <div class="product-box">
      <a href="lipgloss-detail.html">
        <img src="../images/kajal1.avif" alt="kajal" class="product-image">
      </a>
      <h3 class="product-name">Lakme Eyeconic Kajal in Deep Black Twist Up Pencil</h3>
    
      <div class="price-row">
        <span class="mrp"><del>â‚¹210</del></span>
        <span class="price">â‚¹200</span>
        <span class="discount">5% Off</span>
      </div>
      <button class="add-to-cart-btn" onclick="addToCart('prod-8', 'Lakme Kajal', 'â‚¹200', 'kajal1.avif')">Add to Cart</button>
      <div class="rating-stars">â˜…â˜…â˜…â˜…â˜† <span>(47542)</span></div>
      <p class="shade-count">5 Shades</p>
    </div>

  </div>
</section>

  
<section class="beauty-tips-section">
  <h2>Beauty Tips & Tutorials</h2>
  <p class="subtitle">Unlock the secrets to flawless beauty with expert tips and step-by-step tutorials</p>

  <div class="tips-cards">
    <article class="tip-card">
      <div class="image-wrapper">
        <img src="../images/perfectwinglinervideo.webp" alt="Perfect Winged Eyeliner">
      </div>
      <div class="content">
        <h3>Perfect Winged Eyeliner</h3>
        <p>Master the art of winged eyeliner with our step-by-step guide for flawless results every time.</p>
        <a href="perfecteyeliner.html" class="read-more">Read More â†’</a>
      </div>
    </article>

    <article class="tip-card">
      <div class="image-wrapper">
        <img src="../images/skincareroutine.jpg" alt="Morning Skincare Routine">
      </div>
      <div class="content">
        <h3>Morning Skincare Routine</h3>
        <p>Start your day right with this refreshing morning skincare routine for glowing, healthy skin.</p>
        <a href="morningskincare.html" class="read-more">Read More â†’</a>
      </div>
    </article>

    <article class="tip-card">
      <div class="image-wrapper">
        <img src="../images/color matching video.jpg" alt="Color Matching Foundation">
      </div>
      <div class="content">
        <h3>Color Matching Foundation</h3>
        <p>Find your perfect foundation shade with our expert tips for color matching different skin tones.</p>
        <a href="matchingcolour.html" class="read-more">Read More â†’</a>
      </div>
    </article>
  </div>
</section>

<section class="testimonials">
  <div class="container">
    <h2>What Our Customers Say</h2>
    <p class="subtitle">Join thousands of satisfied customers who trust Veloura for their beauty needs</p>

    <div class="testimonial-cards">
      <div class="testimonial-card">
        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
        <p class="quote">"Absolutely love the L'OrÃ©al serum foundation! It blends so smoothly and gives a natural glow. Fast delivery too!"<p>
        <div class="customer-info">
          <img src="../images/userimag.webp" alt="Aarushi mehta" />
          <div>
            <strong>Aarushi Mheta</strong>
            <p>Mumbai, India</p>
          </div>
        </div>
      </div>

      <div class="testimonial-card">
        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
        <p class="quote">"This site has everything I need â€” affordable prices, amazing brands, and even surprise gifts. I'm obsessed!"</p>
        <div class="customer-info">
          <img src="../images/userimag.webp" alt="Emma Rodriguez" />
          <div>
            <strong>Simran</strong>
            <p>Delhi, India</p>
          </div>
        </div>
      </div>

      <div class="testimonial-card">
        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
        <p class="quote">"I was skeptical, but the Minimalist facewash really cleared my skin. Will reorder for sure!"</p>
        <div class="customer-info">
          <img src="../images/userimag.webp" alt="Lily Wang" />
          <div>
            <strong>Priya Sharma</strong>
            <p>Pune,India</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Chatbot -->

<!-- Floating Chat Button -->
  <div class="chat-btn" id="chat-btn">ðŸ’¬</div>

  <!-- Chat Box -->
  <div class="chat-box" id="chat-box">
    <div class="chat-header">Beauty Bot </div>
    <div class="chat-content">
      <p> Let's find your perfect product âœ¨</p>

      <!-- Step 1: Concern Area -->
      <div id="step1">
        <label>Select Concern Area:</label>
        <select id="area">
          <option value="">--Choose--</option>
          <option value="face">Face</option>
          <option value="eyes">Eyes</option>
          <option value="lips">Lips</option>
        </select>
      </div>

      <!-- Step 2: Skin Type (only for face) -->
      <div id="step2" style="display:none;">
        <label>Select Skin Type:</label>
        <select id="skinType">
          <option value="">--Choose--</option>
          <option value="oily">Oily</option>
          <option value="dry">Dry</option>
          <option value="normal">Normal</option>
          <option value="combination">Combination</option>
          <option value="sensitive">Sensitive</option>
        </select>
      </div>

      <!-- Step 3: Issue (face, eyes or lips) -->
      <div id="step3" style="display:none;">
        <label id="issueLabel">Select Issue:</label>
        <select id="issue">
          <option value="">--Choose--</option>
        </select>
      </div>

      <!-- Suggest button -->
      <button id="suggestBtn" style="display:none;">Get Suggestion</button>

      <div id="result"></div>
    </div>
  </div>





<section class="instagram-section">
  <div class="instagram-header">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M7.75 2h8.5A5.75 5.75 0 0122 7.75v8.5A5.75 5.75 0 0116.25 22h-8.5A5.75 5.75 0 012 16.25v-8.5A5.75 5.75 0 017.75 2zm0 1.5A4.25 4.25 0 003.5 7.75v8.5A4.25 4.25 0 007.75 20.5h8.5a4.25 4.25 0 004.25-4.25v-8.5A4.25 4.25 0 0016.25 3.5h-8.5zM12 7a5 5 0 110 10 5 5 0 010-10zm0 1.5a3.5 3.5 0 100 7 3.5 3.5 0 000-7zm4.75-.75a1.25 1.25 0 110 2.5 1.25 1.25 0 010-2.5z"/>
    </svg>
    <span>#VelouraBeauty</span>
  </div>
  <p class="subtitle">See how our community creates stunning looks with Veloura products</p>
  
  <div class="gallery">
    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=140&q=80" alt="Product 1" />
    <img src="https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?auto=format&fit=crop&w=140&q=80" alt="Product 2" />
    <img src="https://images.unsplash.com/photo-1515377905703-c4788e51af15?auto=format&fit=crop&w=140&q=80" alt="Product 3" />
    <img src="https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?auto=format&fit=crop&w=140&q=80" alt="Product 4" />
  </div>

<a href="insta.html">
  <button class="follow-button">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M7.75 2h8.5A5.75 5.75 0 0122 7.75v8.5A5.75 5.75 0 0116.25 22h-8.5A5.75 5.75 0 012 16.25v-8.5A5.75 5.75 0 017.75 2zm0 1.5A4.25 4.25 0 003.5 7.75v8.5A4.25 4.25 0 007.75 20.5h8.5a4.25 4.25 0 004.25-4.25v-8.5A4.25 4.25 0 0016.25 3.5h-8.5zM12 7a5 5 0 110 10 5 5 0 010-10zm0 1.5a3.5 3.5 0 100 7 3.5 3.5 0 000-7zm4.75-.75a1.25 1.25 0 110 2.5 1.25 1.25 0 010-2.5z"/>
    </svg>
    Follow @VelouraBeauty
  </button>
</a>
</section>

<footer class="footer">
  <div class="footer-container">
    <div class="footer-about">
      <h3>Veloura Beauty</h3>
      <p>Your trusted destination for luxury beauty products and tips. Bringing confidence and glow to your life.</p>
    </div>

    <div class="footer-links">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="ABOUTus.html">About Us</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>

    <div class="footer-contact">
      <h4>Contact Us</h4>
      <p>Email: support@veloura.com</p>
      <p>Phone: +91 234 567 8901</p>
    </div>
  </div>

  <div class="footer-bottom">
    <p>Â© 2025 Veloura Beauty. All rights reserved.</p>
  </div>
</footer>

<!-- <script src="../javascript/script.js"></script> -->



<script>

const API_BASE = "http://localhost:3000"; // json-server base
const CART_API_URL = `${API_BASE}/cart`;
const PRODUCTS_PATH = "./javascript/products.json"; // change path if your products.json is elsewhere

document.addEventListener("DOMContentLoaded", () => {

  async function safeFetchJson(url, opts) {
    try {
      const r = await fetch(url, opts);
      if (!r.ok) { console.warn(`Request to ${url} returned ${r.status}`); return null; }
      try { return await r.json(); } catch(e){ console.warn("Failed parse JSON from", url); return null; }
    } catch (err) { console.error("Network error fetching", url, err); return null; }
  }

  function numericPriceFrom(v) { if (v == null) return 0; return Number(String(v).replace(/[^\d.-]/g,'')) || 0; }

  function normalizeImagePathToAbsolute(img) {
    if (!img) return window.location.origin + "/images/placeholder.png";
    img = String(img).trim();
    if (img.startsWith("http://") || img.startsWith("https://")) return img;
    if (img.startsWith("../")) {
      const without = img.replace(/^\.\.\//, "");
      return window.location.origin + "/" + without.replace(/^\/+/, "");
    }
    if (img.startsWith("/")) return window.location.origin + img;
    if (img.includes("/")) return window.location.origin + "/" + img.replace(/^\/+/, "");
    return window.location.origin + "/images/" + img;
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

  /* Render products from products.json (if .product-grid exists) */
  async function renderProducts() {
    const products = await safeFetchJson(PRODUCTS_PATH);
    if (!Array.isArray(products)) return;
    const container = document.querySelector(".product-grid") || document.querySelector(".products");
    if (!container) return;
    container.innerHTML = "";
    products.forEach(prod => {
      const title = prod.title || prod.name || "Product";
      const priceNum = numericPriceFrom(prod.price ?? prod.mrp ?? prod.amount);
      const img = normalizeImagePathToAbsolute(prod.image || prod.img || "");
      const card = document.createElement("div");
      card.className = "product-box";
      card.style = "background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);";
      card.innerHTML = `
        <a href="#"><img src="${escapeHtml(img)}" alt="${escapeHtml(title)}" class="product-image" style="width:100%;height:160px;object-fit:cover;border-radius:6px;"></a>
        <h3 class="product-name" style="margin:8px 0 6px">${escapeHtml(title)}</h3>
        <div class="price-row"><span class="price">â‚¹${priceNum}</span></div>
        <button class="add-to-cart-btn" style="margin-top:8px;padding:8px 10px;border-radius:8px;background:#c2185b;color:white;border:none;cursor:pointer;"
                data-id="${escapeHtml(String(prod.id ?? ""))}"
                data-title="${escapeHtml(title)}"
                data-price="${escapeHtml(String(priceNum))}"
                data-image="${escapeHtml(img)}">
          Add to Cart
        </button>
      `;
      container.appendChild(card);
    });
  }

  /* Convert inline onclick(... ) to data-* if any remain */
  function patchInlineOnclicks() {
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
      const onclick = btn.getAttribute('onclick');
      if (!onclick) return;
      const matches = [...onclick.matchAll(/'([^']*)'/g)].map(m => m[1]);
      if (matches.length >= 4) {
        const [id, title, priceRaw, image] = matches;
        btn.dataset.id = id;
        btn.dataset.title = title;
        btn.dataset.price = numericPriceFrom(priceRaw);
        btn.dataset.image = normalizeImagePathToAbsolute(image);
        btn.removeAttribute('onclick');
      } else console.warn("Could not parse inline onclick:", onclick);
    });
  }

  /* Cart UI references */
  const cartlist = document.getElementById("cartlist");
  const cartCountSpan = document.getElementById("cart-count") || document.querySelector(".badge");

  async function updateCartCount() {
    const items = await safeFetchJson(CART_API_URL);
    let count = 0;
    if (Array.isArray(items)) items.forEach(i => { count += (Number(i.qty) || 0); });
    if (cartCountSpan) cartCountSpan.innerText = String(count);
  }

  async function getCartItems() {
    if (!cartlist) return;
    const items = await safeFetchJson(CART_API_URL);
    cartlist.innerHTML = "";
    if (!items || items.length === 0) {
      cartlist.innerHTML = "<p>Your cart is empty.</p>";
      updateCartCount();
      return;
    }
    let totalAmount = 0, totalQty = 0;
    items.forEach(it => {
      const price = numericPriceFrom(it.price);
      const qty = Number(it.qty) || 0;
      totalAmount += price * qty;
      totalQty += qty;
      const imgSrc = normalizeImagePathToAbsolute(it.image || "");
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <img src="${escapeHtml(imgSrc)}" width="70" alt="${escapeHtml(it.title || '')}">
        <div class="cart-item-info">
          <p class="cart-title">${escapeHtml(it.title || '')}</p>
          <p class="cart-price">â‚¹${price} x ${qty}</p>
          <div class="cart-actions">
            <button class="qty-btn" data-id="${it.id}" data-action="decrease">-</button>
            <button class="qty-btn" data-id="${it.id}" data-action="increase">+</button>
            <button class="remove-btn" data-id="${it.id}">Remove</button>
          </div>
        </div>
      `;
      cartlist.appendChild(div);
    });
    const totalElement = document.getElementById("cart-total-amount");
    if (totalElement) totalElement.innerText = `Total (${totalQty} items): â‚¹${totalAmount}`;
    updateCartCount();
  }

  /* Cart actions */
  async function changeQty(id, newQty) {
    if (!id) return;
    if (newQty <= 0) { await removeFromCart(id); return; }
    try {
      await fetch(`${CART_API_URL}/${id}`, { method: "PATCH", headers: {"Content-Type":"application/json"}, body: JSON.stringify({ qty: newQty }) });
      await getCartItems();
    } catch(e){ console.error(e); }
  }
  async function removeFromCart(id) {
    if (!id) return;
    try {
      await fetch(`${CART_API_URL}/${id}`, { method: "DELETE" });
      await getCartItems();
    } catch(e){ console.error(e); }
  }

  if (cartlist) {
    cartlist.addEventListener("click", ev => {
      const t = ev.target;
      if (t.classList.contains("qty-btn")) {
        const id = t.dataset.id;
        const action = t.dataset.action;
        const priceText = t.closest(".cart-item").querySelector(".cart-price").textContent;
        const match = priceText.match(/x\s*(\d+)/);
        const curQty = match ? Number(match[1]) : 0;
        if (action === "increase") changeQty(id, curQty + 1);
        else if (action === "decrease") changeQty(id, curQty - 1);
      } else if (t.classList.contains("remove-btn")) {
        removeFromCart(t.dataset.id);
      }
    });
  }

  /* Add-to-cart handling */
  function attachAddToCartHandlers() {
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const title = btn.dataset.title || (btn.closest('.product-box') && (btn.closest('.product-box').querySelector('.product-name')?.innerText.trim()));
        const price = numericPriceFrom(btn.dataset.price || (btn.closest('.product-box') && (btn.closest('.product-box').querySelector('.price')?.innerText)));
        let image = btn.dataset.image || (btn.closest('.product-box') && (btn.closest('.product-box').querySelector('img')?.getAttribute('src') || btn.closest('.product-box').querySelector('img')?.src)) || "";
        image = normalizeImagePathToAbsolute(image);
        if (!title) { alert("Cannot add to cart: product title missing"); return; }
        const product = { title, price, qty: 1, image };

        try {
          const existing = await safeFetchJson(`${CART_API_URL}?title=${encodeURIComponent(title)}`) || [];
          if (existing.length > 0) {
            const it = existing[0];
            await fetch(`${CART_API_URL}/${it.id}`, { method: "PATCH", headers: {"Content-Type":"application/json"}, body: JSON.stringify({ qty: (Number(it.qty)||0)+1 }) });
            alert(`${title} quantity increased`);
            updateCartCount();
            getCartItems();
          } else {
            await fetch(CART_API_URL, { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(product) });
            alert(`${title} added to cart`);
            updateCartCount();
            getCartItems();
          }
        } catch(err){ console.error("Add to cart failed", err); alert("Add to cart failed (see console)"); }
      });
    });
  }

  /* init */
  (async function init(){
    await renderProducts();
    patchInlineOnclicks();
    attachAddToCartHandlers();
    await getCartItems();
    await updateCartCount();
  })();

});
</script>

  <script src="../javascript/script.js"></script>
  <script src="../javascript/userAccount.js"></script>
</body>
</html>
